<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Painel Principal - J.P Sistemas</title>
    <link rel="icon" href="https://i.imgur.com/QgVsPmF.png" type="image/png" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="mobile.css">
  </head>
  <body>
    <div class="app-layout">
      <header>
      <div class="header-content">
        <div class="logo">
            <img src="https://i.imgur.com/2jT2EPD.png" alt="Logo J.P Sistemas" />
        </div>
          <nav>
            <span class="welcome-message">Bem-vindo, <span id="userDisplay"></span></span>
            <button class="btn btn-danger" onclick="logout()">
            <i class="fas fa-sign-out-alt"></i> Sair
          </button>
          </nav>
      </div>
    </header>

      <main>
        <div class="container">
          <div class="dashboard">
            <div class="dashboard-header">
              <h1 class="dashboard-title">Painel Principal</h1>
              <p class="dashboard-subtitle">Gerencie seus clientes, produtos, pedidos e relatórios de forma eficiente</p>
      </div>

      <!-- Dashboard Pequeno -->
            <div class="cards">
              <div class="card" title="Total de clientes cadastrados.">
                <div class="card-header">
                  <div class="card-icon">
          <i class="fas fa-users"></i>
                  </div>
                </div>
                <div class="card-value" id="dashboardClientes">--</div>
                <div class="card-title">Clientes</div>
        </div>
              
              <div class="card" title="Total de produtos cadastrados.">
                <div class="card-header">
                  <div class="card-icon">
          <i class="fas fa-box"></i>
                  </div>
                </div>
                <div class="card-value" id="dashboardProdutos">--</div>
                <div class="card-title">Produtos</div>
        </div>
              
              <div class="card" title="Total de pedidos realizados no mês.">
                <div class="card-header">
                  <div class="card-icon">
          <i class="fas fa-shopping-cart"></i>
                  </div>
                </div>
                <div class="card-value" id="dashboardPedidos">--</div>
                <div class="card-title">Pedidos</div>
        </div>
              
              <div class="card" title="Valor total das vendas concluídas no mês.">
                <div class="card-header">
                  <div class="card-icon">
          <i class="fas fa-coins"></i>
                  </div>
                </div>
                <div class="card-value" id="dashboardVendas">--</div>
                <div class="card-title">Vendas do mês</div>
        </div>
      </div>

            <!-- Menu de Navegação -->
      <div class="menu-grid">
        <a href="painel-clientes.html" class="menu-card">
          <i class="fas fa-users"></i>
          <h3>Clientes</h3>
                <p>Gerencie o cadastro de clientes, visualize informações e mantenha dados atualizados</p>
        </a>

        <a href="produtos.html" class="menu-card">
          <i class="fas fa-box"></i>
          <h3>Produtos</h3>
                <p>Controle seu estoque de produtos, preços e informações detalhadas</p>
        </a>

        <a href="pedidos.html" class="menu-card">
          <i class="fas fa-shopping-cart"></i>
          <h3>Pedidos</h3>
                <p>Crie e gerencie pedidos, acompanhe status e gere relatórios</p>
        </a>

        <a href="relatorios.html" class="menu-card">
          <i class="fas fa-chart-bar"></i>
                <h3>Relatórios</h3>
                <p>Visualize relatórios detalhados de vendas, clientes e produtos</p>
        </a>

        <a href="configuracoes.html" class="menu-card">
          <i class="fas fa-cog"></i>
                <h3>Configurações</h3>
                <p>Configure preferências do sistema e gerencie usuários</p>
        </a>

        <a href="ajuda.html" class="menu-card">
          <i class="fas fa-question-circle"></i>
          <h3>Ajuda</h3>
          <p>Encontre ajuda e suporte para usar o sistema</p>
        </a>
      </div>

            <!-- Resumo Financeiro -->
            <div class="section">
              <div class="section-header">
                <h2 class="section-title">
                  <i class="fas fa-wallet"></i> Resumo Financeiro
                </h2>
              </div>
              
              <div class="cards">
                <div class="card" title="Total de contas a pagar, somando todos os lançamentos em aberto.">
                  <div class="card-header">
                    <div class="card-icon">
            <i class="fas fa-arrow-circle-up"></i>
                    </div>
                  </div>
                  <div class="card-value text-red-600" id="dashboardPagar">--</div>
                  <div class="card-title">Contas a Pagar</div>
          </div>
                
                <div class="card" title="Total de contas a receber, somando todos os lançamentos em aberto.">
                  <div class="card-header">
                    <div class="card-icon">
            <i class="fas fa-arrow-circle-down"></i>
                    </div>
                  </div>
                  <div class="card-value text-green-600" id="dashboardReceber">--</div>
                  <div class="card-title">Contas a Receber</div>
          </div>
                
                <div class="card" title="Lucro estimado do mês, considerando vendas concluídas.">
                  <div class="card-header">
                    <div class="card-icon">
            <i class="fas fa-coins"></i>
                    </div>
                  </div>
                  <div class="card-value text-yellow-500" id="dashboardLucro">--</div>
                  <div class="card-title">Lucro do mês</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>

      <footer>
        <div class="container">
          <p class="text-center">
            © 2025 J.P Sistemas. Todos os direitos reservados. 
            <a href="https://whatsa.me/5548996852138/?t=Ola,%20gostaria%20de%20mais%20informacoes%20sobre%20os%20sistemas." target="_blank" style="color: var(--white); text-decoration: underline; font-weight: 500;">Fale conosco no WhatsApp</a>
          </p>
      </div>
    </footer>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // Verificar se está logado
        if (sessionStorage.getItem('loggedIn') !== 'true') {
          window.location.href = 'index.html';
        }

        // Exibir nome do usuário
        const username = sessionStorage.getItem('username') || 'Usuário';
        document.getElementById('userDisplay').textContent = username;

        // Buscar dados do dashboard
        fetch('/api/relatorios/estatisticas', { credentials: 'include' })
          .then(res => res.json())
          .then(data => {
            document.getElementById('dashboardClientes').textContent = data.totalClientes ?? '--';
            document.getElementById('dashboardProdutos').textContent = data.totalProdutos ?? '--';
            document.getElementById('dashboardPedidos').textContent = data.pedidosMes ?? '--';
            document.getElementById('dashboardVendas').textContent = data.vendasMes ? 'R$ ' + Number(data.vendasMes).toLocaleString('pt-BR', { minimumFractionDigits: 2 }) : '--';
          })
          .catch(() => {
            document.getElementById('dashboardClientes').textContent = '--';
            document.getElementById('dashboardProdutos').textContent = '--';
            document.getElementById('dashboardPedidos').textContent = '--';
            document.getElementById('dashboardVendas').textContent = '--';
          });

        // Buscar contas a pagar e receber
        fetch('/api/contas/pagar', { credentials: 'include' })
          .then(res => res.json())
          .then(lista => {
            const total = lista.reduce((acc, c) => acc + Number(c.valor || 0), 0);
            document.getElementById('dashboardPagar').textContent = 'R$ ' + total.toLocaleString('pt-BR', { minimumFractionDigits: 2 });
          })
          .catch(() => {
            document.getElementById('dashboardPagar').textContent = '--';
          });
        fetch('/api/contas/receber', { credentials: 'include' })
          .then(res => res.json())
          .then(lista => {
            const total = lista.reduce((acc, c) => acc + Number(c.valor || 0), 0);
            document.getElementById('dashboardReceber').textContent = 'R$ ' + total.toLocaleString('pt-BR', { minimumFractionDigits: 2 });
          })
          .catch(() => {
            document.getElementById('dashboardReceber').textContent = '--';
          });

        // Buscar lucro do mês
        fetch('/api/relatorios/estatisticas', { credentials: 'include' })
          .then(res => res.json())
          .then(data => {
            document.getElementById('dashboardLucro').textContent = data.lucroMes ? 'R$ ' + Number(data.lucroMes).toLocaleString('pt-BR', { minimumFractionDigits: 2 }) : '--';
          })
          .catch(() => {
            document.getElementById('dashboardLucro').textContent = '--';
          });
      });
      
      // Função logout global
      async function logout() {
        await fetch('/api/auth/logout', { method: 'POST', credentials: 'include' });
        sessionStorage.removeItem('loggedIn');
        sessionStorage.removeItem('username');
        window.location.href = 'sistema.html';
      }
    </script>
  </body>
</html>
