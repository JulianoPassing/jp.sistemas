<!--
  RESPONSIVIDADE MOBILE:
  - Este arquivo já inclui <meta name="viewport"> e mobile.css para responsividade.
  - Use as classes .coluna-desnecessaria ou .hide-mobile em <th> ou <td> para esconder colunas no mobile.
  - Para navegação fixa no rodapé, utilize <nav class="mobile-nav">.
  - Mantenha sempre o mobile.css atualizado para melhor experiência mobile.
-->
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gestão de Clientes - J.P Sistemas Comercial</title>
  <link rel="icon" href="https://i.imgur.com/QgVsPmF.png" type="image/png" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="app-layout">
    <header>
      <div class="header-content">
        <a href="index.html" class="logo">
          <h1>J.P Sistemas Comercial</h1>
        </a>
        <div class="user-info">
          <span>Bem-vindo, <span id="userDisplay"></span></span>
          <a href="index.html" class="btn btn-secondary">
            <i class="fas fa-sign-out-alt"></i>
            Sair
          </a>
        </div>
      </div>
    </header>

    <main>
      <div class="container">
        <div class="dashboard">
          <div class="dashboard-header">
            <h1 class="dashboard-title">Gestão de Clientes</h1>
            <p class="dashboard-subtitle">Gerencie seus clientes de forma eficiente</p>
          </div>

          <div class="section">
            <div class="section-header">
              <h2 class="section-title">
                <i class="fas fa-users"></i>
                Clientes Cadastrados
              </h2>
              <div class="btn-group">
                <button id="adicionarCliente" class="btn btn-primary">
                  <i class="fas fa-plus"></i>
                  Adicionar Cliente
                </button>
                <button id="exportarClientes" class="btn btn-secondary">
                  <i class="fas fa-download"></i>
                  Exportar
                </button>
              </div>
            </div>

            <div class="search-container">
              <div class="search-group">
                <input type="text" id="buscaCliente" class="form-input" placeholder="Buscar por nome, CPF, telefone...">
                <button id="btnBuscar" class="btn btn-primary">
                  <i class="fas fa-search"></i>
                  Buscar
                </button>
              </div>
              <div class="filter-group">
                <select id="filtroStatus" class="form-input">
                  <option value="">Todos os status</option>
                  <option value="ativo">Ativo</option>
                  <option value="inativo">Inativo</option>
                </select>
                <select id="filtroCidade" class="form-input">
                  <option value="">Todas as cidades</option>
                </select>
              </div>
            </div>

            <div class="table-container">
              <table class="table" id="tabelaClientes">
                <thead>
                  <tr>
                    <th>Nome</th>
                    <th>CPF/CNPJ</th>
                    <th>Telefone</th>
                    <th>E-mail</th>
                    <th>Cidade</th>
                    <th>Status</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody id="listaClientes">
                  <!-- Clientes serão carregados aqui -->
                </tbody>
              </table>
            </div>

            <div class="pagination">
              <button id="btnAnterior" class="btn btn-secondary">
                <i class="fas fa-chevron-left"></i>
                Anterior
              </button>
              <span id="infoPagina">Página 1 de 1</span>
              <button id="btnProximo" class="btn btn-secondary">
                Próximo
                <i class="fas fa-chevron-right"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer>
      <div class="container">
        <p class="text-center">&copy; 2024 J.P Sistemas Comercial. Todos os direitos reservados.</p>
      </div>
    </footer>
  </div>

  <!-- Modal para adicionar/editar cliente -->
  <div id="modalCliente" class="modal">
    <div class="modal-overlay"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modalTitulo">Adicionar Cliente</h3>
        <button class="modal-close" onclick="fecharModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <form id="formCliente">
          <div class="grid grid-cols-2">
            <div class="form-group">
              <label class="form-label">Nome/Razão Social *</label>
              <input type="text" id="nomeCliente" class="form-input" required>
            </div>

            <div class="form-group">
              <label class="form-label">CPF/CNPJ *</label>
              <input type="text" id="cpfCliente" class="form-input" required>
            </div>

            <div class="form-group">
              <label class="form-label">Telefone</label>
              <input type="text" id="telefoneCliente" class="form-input">
            </div>

            <div class="form-group">
              <label class="form-label">E-mail</label>
              <input type="email" id="emailCliente" class="form-input">
            </div>

            <div class="form-group">
              <label class="form-label">Endereço</label>
              <input type="text" id="enderecoCliente" class="form-input">
            </div>

            <div class="form-group">
              <label class="form-label">Cidade</label>
              <input type="text" id="cidadeCliente" class="form-input">
            </div>

            <div class="form-group">
              <label class="form-label">Estado</label>
              <select id="estadoCliente" class="form-input">
                <option value="">Selecione...</option>
                <option value="AC">Acre</option>
                <option value="AL">Alagoas</option>
                <option value="AP">Amapá</option>
                <option value="AM">Amazonas</option>
                <option value="BA">Bahia</option>
                <option value="CE">Ceará</option>
                <option value="DF">Distrito Federal</option>
                <option value="ES">Espírito Santo</option>
                <option value="GO">Goiás</option>
                <option value="MA">Maranhão</option>
                <option value="MT">Mato Grosso</option>
                <option value="MS">Mato Grosso do Sul</option>
                <option value="MG">Minas Gerais</option>
                <option value="PA">Pará</option>
                <option value="PB">Paraíba</option>
                <option value="PR">Paraná</option>
                <option value="PE">Pernambuco</option>
                <option value="PI">Piauí</option>
                <option value="RJ">Rio de Janeiro</option>
                <option value="RN">Rio Grande do Norte</option>
                <option value="RS">Rio Grande do Sul</option>
                <option value="RO">Rondônia</option>
                <option value="RR">Roraima</option>
                <option value="SC">Santa Catarina</option>
                <option value="SP">São Paulo</option>
                <option value="SE">Sergipe</option>
                <option value="TO">Tocantins</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">CEP</label>
              <input type="text" id="cepCliente" class="form-input">
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Observações</label>
            <textarea id="observacoesCliente" class="form-input" rows="3"></textarea>
          </div>

          <div class="form-group">
            <label class="form-label">
              <input type="checkbox" id="statusCliente" checked>
              Cliente ativo
            </label>
          </div>

          <div class="modal-actions">
            <button type="button" class="btn btn-secondary" onclick="fecharModal()">
              Cancelar
            </button>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-save"></i>
              Salvar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal de confirmação -->
  <div id="modalConfirmacao" class="modal">
    <div class="modal-overlay"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3>Confirmar Ação</h3>
        <button class="modal-close" onclick="fecharModalConfirmacao()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <p id="mensagemConfirmacao">Tem certeza que deseja realizar esta ação?</p>
        <div class="modal-actions">
          <button class="btn btn-secondary" onclick="fecharModalConfirmacao()">
            Cancelar
          </button>
          <button id="btnConfirmar" class="btn btn-danger">
            Confirmar
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Verificar se o usuário está logado
    document.addEventListener('DOMContentLoaded', function() {
      const user = localStorage.getItem('user');
      if (!user) {
        window.location.href = 'index.html';
        return;
      }

      try {
        const userData = JSON.parse(user);
        const userDisplay = document.getElementById('userDisplay');
        if (userDisplay && userData.nome) {
          // Capitalizar primeira letra do nome
          const nome = userData.nome.charAt(0).toUpperCase() + userData.nome.slice(1);
          userDisplay.textContent = nome;
        }
      } catch (error) {
        console.error('Erro ao carregar dados do usuário:', error);
        window.location.href = 'index.html';
      }

      // Carregar clientes
      carregarClientes();
      carregarFiltros();
    });

    // Variáveis globais
    let clientes = [];
    let clienteEditando = null;
    let paginaAtual = 1;
    const itensPorPagina = 10;

    // Carregar clientes
    async function carregarClientes() {
      try {
        const response = await fetch('/api/clientes');
        clientes = await response.json();
        exibirClientes();
      } catch (error) {
        console.error('Erro ao carregar clientes:', error);
        // Dados de exemplo para demonstração
        clientes = [
          {
            id: 1,
            nome: 'João Silva',
            cpf: '123.456.789-00',
            telefone: '(11) 99999-9999',
            email: 'joao@email.com',
            cidade: 'São Paulo',
            status: 'ativo'
          },
          {
            id: 2,
            nome: 'Maria Santos',
            cpf: '987.654.321-00',
            telefone: '(11) 88888-8888',
            email: 'maria@email.com',
            cidade: 'Rio de Janeiro',
            status: 'ativo'
          }
        ];
        exibirClientes();
      }
    }

    // Exibir clientes na tabela
    function exibirClientes() {
      const tbody = document.getElementById('listaClientes');
      tbody.innerHTML = '';

      const inicio = (paginaAtual - 1) * itensPorPagina;
      const fim = inicio + itensPorPagina;
      const clientesPagina = clientes.slice(inicio, fim);

      clientesPagina.forEach(cliente => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${cliente.nome}</td>
          <td>${cliente.cpf}</td>
          <td>${cliente.telefone || '-'}</td>
          <td>${cliente.email || '-'}</td>
          <td>${cliente.cidade || '-'}</td>
          <td>
            <span class="badge ${cliente.status === 'ativo' ? 'badge-success' : 'badge-danger'}">
              ${cliente.status === 'ativo' ? 'Ativo' : 'Inativo'}
            </span>
          </td>
          <td>
            <button class="btn btn-primary btn-sm" onclick="editarCliente(${cliente.id})">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-danger btn-sm" onclick="excluirCliente(${cliente.id})">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      });

      atualizarPaginacao();
    }

    // Atualizar paginação
    function atualizarPaginacao() {
      const totalPaginas = Math.ceil(clientes.length / itensPorPagina);
      document.getElementById('infoPagina').textContent = `Página ${paginaAtual} de ${totalPaginas}`;
      
      document.getElementById('btnAnterior').disabled = paginaAtual === 1;
      document.getElementById('btnProximo').disabled = paginaAtual === totalPaginas;
    }

    // Navegação da paginação
    document.getElementById('btnAnterior').addEventListener('click', function() {
      if (paginaAtual > 1) {
        paginaAtual--;
        exibirClientes();
      }
    });

    document.getElementById('btnProximo').addEventListener('click', function() {
      const totalPaginas = Math.ceil(clientes.length / itensPorPagina);
      if (paginaAtual < totalPaginas) {
        paginaAtual++;
        exibirClientes();
      }
    });

    // Buscar clientes
    document.getElementById('btnBuscar').addEventListener('click', function() {
      const termo = document.getElementById('buscaCliente').value.toLowerCase();
      const clientesFiltrados = clientes.filter(cliente => 
        cliente.nome.toLowerCase().includes(termo) ||
        cliente.cpf.includes(termo) ||
        (cliente.telefone && cliente.telefone.includes(termo))
      );
      
      const tbody = document.getElementById('listaClientes');
      tbody.innerHTML = '';

      clientesFiltrados.forEach(cliente => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${cliente.nome}</td>
          <td>${cliente.cpf}</td>
          <td>${cliente.telefone || '-'}</td>
          <td>${cliente.email || '-'}</td>
          <td>${cliente.cidade || '-'}</td>
          <td>
            <span class="badge ${cliente.status === 'ativo' ? 'badge-success' : 'badge-danger'}">
              ${cliente.status === 'ativo' ? 'Ativo' : 'Inativo'}
            </span>
          </td>
          <td>
            <button class="btn btn-primary btn-sm" onclick="editarCliente(${cliente.id})">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-danger btn-sm" onclick="excluirCliente(${cliente.id})">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    });

    // Adicionar cliente
    document.getElementById('adicionarCliente').addEventListener('click', function() {
      clienteEditando = null;
      document.getElementById('modalTitulo').textContent = 'Adicionar Cliente';
      document.getElementById('formCliente').reset();
      document.getElementById('modalCliente').style.display = 'flex';
    });

    // Editar cliente
    function editarCliente(id) {
      const cliente = clientes.find(c => c.id === id);
      if (cliente) {
        clienteEditando = cliente;
        document.getElementById('modalTitulo').textContent = 'Editar Cliente';
        
        // Preencher formulário
        document.getElementById('nomeCliente').value = cliente.nome;
        document.getElementById('cpfCliente').value = cliente.cpf;
        document.getElementById('telefoneCliente').value = cliente.telefone || '';
        document.getElementById('emailCliente').value = cliente.email || '';
        document.getElementById('enderecoCliente').value = cliente.endereco || '';
        document.getElementById('cidadeCliente').value = cliente.cidade || '';
        document.getElementById('estadoCliente').value = cliente.estado || '';
        document.getElementById('cepCliente').value = cliente.cep || '';
        document.getElementById('observacoesCliente').value = cliente.observacoes || '';
        document.getElementById('statusCliente').checked = cliente.status === 'ativo';
        
        document.getElementById('modalCliente').style.display = 'flex';
      }
    }

    // Excluir cliente
    function excluirCliente(id) {
      const cliente = clientes.find(c => c.id === id);
      if (cliente) {
        document.getElementById('mensagemConfirmacao').textContent = 
          `Tem certeza que deseja excluir o cliente "${cliente.nome}"?`;
        
        document.getElementById('btnConfirmar').onclick = function() {
          clientes = clientes.filter(c => c.id !== id);
          exibirClientes();
          fecharModalConfirmacao();
        };
        
        document.getElementById('modalConfirmacao').style.display = 'flex';
      }
    }

    // Salvar cliente
    document.getElementById('formCliente').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const dadosCliente = {
        nome: document.getElementById('nomeCliente').value,
        cpf: document.getElementById('cpfCliente').value,
        telefone: document.getElementById('telefoneCliente').value,
        email: document.getElementById('emailCliente').value,
        endereco: document.getElementById('enderecoCliente').value,
        cidade: document.getElementById('cidadeCliente').value,
        estado: document.getElementById('estadoCliente').value,
        cep: document.getElementById('cepCliente').value,
        observacoes: document.getElementById('observacoesCliente').value,
        status: document.getElementById('statusCliente').checked ? 'ativo' : 'inativo'
      };

      if (clienteEditando) {
        // Editar cliente existente
        const index = clientes.findIndex(c => c.id === clienteEditando.id);
        if (index !== -1) {
          clientes[index] = { ...clienteEditando, ...dadosCliente };
        }
      } else {
        // Adicionar novo cliente
        const novoCliente = {
          id: Date.now(),
          ...dadosCliente
        };
        clientes.push(novoCliente);
      }

      exibirClientes();
      fecharModal();
    });

    // Exportar clientes
    document.getElementById('exportarClientes').addEventListener('click', function() {
      const ws = XLSX.utils.json_to_sheet(clientes);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Clientes");
      XLSX.writeFile(wb, `clientes_${new Date().toISOString().split('T')[0]}.xlsx`);
    });

    // Carregar filtros
    function carregarFiltros() {
      const cidades = [...new Set(clientes.map(c => c.cidade).filter(c => c))];
      const selectCidade = document.getElementById('filtroCidade');
      
      cidades.forEach(cidade => {
        const option = document.createElement('option');
        option.value = cidade;
        option.textContent = cidade;
        selectCidade.appendChild(option);
      });
    }

    // Filtros
    document.getElementById('filtroStatus').addEventListener('change', aplicarFiltros);
    document.getElementById('filtroCidade').addEventListener('change', aplicarFiltros);

    function aplicarFiltros() {
      const status = document.getElementById('filtroStatus').value;
      const cidade = document.getElementById('filtroCidade').value;
      
      let clientesFiltrados = clientes;
      
      if (status) {
        clientesFiltrados = clientesFiltrados.filter(c => c.status === status);
      }
      
      if (cidade) {
        clientesFiltrados = clientesFiltrados.filter(c => c.cidade === cidade);
      }
      
      const tbody = document.getElementById('listaClientes');
      tbody.innerHTML = '';

      clientesFiltrados.forEach(cliente => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${cliente.nome}</td>
          <td>${cliente.cpf}</td>
          <td>${cliente.telefone || '-'}</td>
          <td>${cliente.email || '-'}</td>
          <td>${cliente.cidade || '-'}</td>
          <td>
            <span class="badge ${cliente.status === 'ativo' ? 'badge-success' : 'badge-danger'}">
              ${cliente.status === 'ativo' ? 'Ativo' : 'Inativo'}
            </span>
          </td>
          <td>
            <button class="btn btn-primary btn-sm" onclick="editarCliente(${cliente.id})">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-danger btn-sm" onclick="excluirCliente(${cliente.id})">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Fechar modais
    function fecharModal() {
      document.getElementById('modalCliente').style.display = 'none';
    }

    function fecharModalConfirmacao() {
      document.getElementById('modalConfirmacao').style.display = 'none';
    }

    // Fechar modais ao clicar fora
    document.querySelectorAll('.modal-overlay').forEach(overlay => {
      overlay.addEventListener('click', function() {
        this.parentElement.style.display = 'none';
      });
    });
  </script>

  <style>
    .btn-group {
      display: flex;
      gap: 0.5rem;
    }

    .search-container {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .search-group {
      display: flex;
      gap: 0.5rem;
      flex: 1;
    }

    .filter-group {
      display: flex;
      gap: 0.5rem;
    }

    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
      margin-top: 1.5rem;
    }

    .btn-sm {
      padding: 0.25rem 0.5rem;
      font-size: 0.75rem;
    }

    @media (max-width: 768px) {
      .search-container {
        flex-direction: column;
      }
      
      .search-group {
        flex-direction: column;
      }
      
      .filter-group {
        flex-direction: column;
      }
      
      .btn-group {
        flex-direction: column;
      }
      
      .grid-cols-2 {
        grid-template-columns: 1fr;
      }
    }
  </style>
</body>
</html> 
