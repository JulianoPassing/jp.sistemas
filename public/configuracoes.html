<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Configurações - J.P Sistemas Comercial</title>
  <link rel="icon" href="https://i.imgur.com/QgVsPmF.png" type="image/png" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="app-layout">
    <header>
      <div class="header-content">
        <a href="index.html" class="logo">
          <h1>J.P Sistemas Comercial</h1>
        </a>
        <div class="user-info">
          <span>Bem-vindo, <span id="userDisplay"></span></span>
          <a href="index.html" class="btn btn-secondary">
            <i class="fas fa-sign-out-alt"></i>
            Sair
          </a>
        </div>
      </div>
    </header>

    <main>
      <div class="container">
        <div class="dashboard">
          <div class="dashboard-header">
            <h1 class="dashboard-title">Configurações</h1>
            <p class="dashboard-subtitle">Gerencie as configurações do sistema</p>
          </div>

          <div class="section">
            <div class="section-header">
              <h2 class="section-title">
                <i class="fas fa-user-cog"></i>
                Configurações de Usuário
              </h2>
            </div>

            <div class="config-area">
              <h3 class="text-lg font-semibold mb-4">
                <i class="fas fa-user"></i>
                Alterar Senha
              </h3>
              
              <div class="form-group">
                <label class="form-label">Senha Atual</label>
                <input type="password" id="senhaAtual" class="form-input" placeholder="Digite sua senha atual">
              </div>

              <div class="form-group">
                <label class="form-label">Nova Senha</label>
                <input type="password" id="novaSenha" class="form-input" placeholder="Digite a nova senha">
              </div>

              <div class="form-group">
                <label class="form-label">Confirmar Nova Senha</label>
                <input type="password" id="confirmarSenha" class="form-input" placeholder="Confirme a nova senha">
              </div>

              <button id="alterarSenha" class="btn btn-primary">
                <i class="fas fa-save"></i>
                Alterar Senha
              </button>
            </div>
          </div>

          <div class="section">
            <div class="section-header">
              <h2 class="section-title">
                <i class="fas fa-building"></i>
                Configurações da Empresa
              </h2>
            </div>

            <div class="config-area">
              <h3 class="text-lg font-semibold mb-4">
                <i class="fas fa-info-circle"></i>
                Dados da Empresa
              </h3>
              
              <div class="grid grid-cols-2">
                <div class="form-group">
                  <label class="form-label">Nome da Empresa</label>
                  <input type="text" id="nomeEmpresa" class="form-input" placeholder="Nome da empresa">
                </div>

                <div class="form-group">
                  <label class="form-label">CNPJ</label>
                  <input type="text" id="cnpjEmpresa" class="form-input" placeholder="00.000.000/0000-00">
                </div>

                <div class="form-group">
                  <label class="form-label">Telefone</label>
                  <input type="text" id="telefoneEmpresa" class="form-input" placeholder="(00) 00000-0000">
                </div>

                <div class="form-group">
                  <label class="form-label">E-mail</label>
                  <input type="email" id="emailEmpresa" class="form-input" placeholder="contato@empresa.com">
                </div>

                <div class="form-group grid-cols-2">
                  <label class="form-label">Endereço</label>
                  <input type="text" id="enderecoEmpresa" class="form-input" placeholder="Rua, número, bairro">
                </div>

                <div class="form-group">
                  <label class="form-label">Cidade/Estado</label>
                  <input type="text" id="cidadeEmpresa" class="form-input" placeholder="Cidade - Estado">
                </div>
              </div>

              <button id="salvarEmpresa" class="btn btn-primary">
                <i class="fas fa-save"></i>
                Salvar Dados da Empresa
              </button>
            </div>
          </div>

          <div class="section">
            <div class="section-header">
              <h2 class="section-title">
                <i class="fas fa-cogs"></i>
                Configurações do Sistema
              </h2>
            </div>

            <div class="config-area">
              <h3 class="text-lg font-semibold mb-4">
                <i class="fas fa-sliders-h"></i>
                Preferências
              </h3>
              
              <div class="grid grid-cols-2">
                <div class="form-group">
                  <label class="form-label">Moeda Padrão</label>
                  <select id="moedaPadrao" class="form-input">
                    <option value="BRL">Real (R$)</option>
                    <option value="USD">Dólar ($)</option>
                    <option value="EUR">Euro (€)</option>
                  </select>
                </div>

                <div class="form-group">
                  <label class="form-label">Fuso Horário</label>
                  <select id="fusoHorario" class="form-input">
                    <option value="America/Sao_Paulo">Brasília (GMT-3)</option>
                    <option value="America/Manaus">Manaus (GMT-4)</option>
                    <option value="America/Belem">Belém (GMT-3)</option>
                  </select>
                </div>

                <div class="form-group">
                  <label class="form-label">Idioma</label>
                  <select id="idioma" class="form-input">
                    <option value="pt-BR">Português (Brasil)</option>
                    <option value="en">English</option>
                    <option value="es">Español</option>
                  </select>
                </div>

                <div class="form-group">
                  <label class="form-label">Tema</label>
                  <select id="tema" class="form-input">
                    <option value="light">Claro</option>
                    <option value="dark">Escuro</option>
                    <option value="auto">Automático</option>
                  </select>
                </div>
              </div>

              <button id="salvarPreferencias" class="btn btn-primary">
                <i class="fas fa-save"></i>
                Salvar Preferências
              </button>
            </div>
          </div>

          <div class="section">
            <div class="section-header">
              <h2 class="section-title">
                <i class="fas fa-database"></i>
                Backup e Restauração
              </h2>
            </div>

            <div class="config-area">
              <h3 class="text-lg font-semibold mb-4">
                <i class="fas fa-download"></i>
                Backup do Sistema
              </h3>
              
              <div class="cards">
                <div class="card">
                  <div class="card-header">
                    <i class="fas fa-download card-icon"></i>
                    <h3 class="card-title">Backup Manual</h3>
                  </div>
                  <p class="text-gray-600 mb-4">Faça um backup completo dos dados do sistema</p>
                  <button id="fazerBackup" class="btn btn-primary">
                    <i class="fas fa-download"></i>
                    Fazer Backup
                  </button>
                </div>

                <div class="card">
                  <div class="card-header">
                    <i class="fas fa-upload card-icon"></i>
                    <h3 class="card-title">Restaurar Backup</h3>
                  </div>
                  <p class="text-gray-600 mb-4">Restaura dados de um backup anterior</p>
                  <input type="file" id="arquivoBackup" accept=".json,.sql" style="display: none;">
                  <button id="restaurarBackup" class="btn btn-warning">
                    <i class="fas fa-upload"></i>
                    Selecionar Arquivo
                  </button>
                </div>
              </div>

              <div class="mt-6">
                <h3 class="text-lg font-semibold mb-4">Backups Automáticos</h3>
                <div class="form-group">
                  <label class="form-label">
                    <input type="checkbox" id="backupAutomatico" class="mr-2">
                    Ativar backup automático
                  </label>
                </div>
                
                <div class="form-group">
                  <label class="form-label">Frequência do Backup</label>
                  <select id="frequenciaBackup" class="form-input">
                    <option value="daily">Diário</option>
                    <option value="weekly">Semanal</option>
                    <option value="monthly">Mensal</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer>
      <div class="container">
        <p class="text-center">&copy; 2024 J.P Sistemas Comercial. Todos os direitos reservados.</p>
      </div>
    </footer>
  </div>

  <script>
    // Verificar se o usuário está logado
    document.addEventListener('DOMContentLoaded', function() {
      const user = localStorage.getItem('user');
      if (!user) {
        window.location.href = 'index.html';
        return;
      }

      try {
        const userData = JSON.parse(user);
        const userDisplay = document.getElementById('userDisplay');
        if (userDisplay && userData.nome) {
          // Capitalizar primeira letra do nome
          const nome = userData.nome.charAt(0).toUpperCase() + userData.nome.slice(1);
          userDisplay.textContent = nome;
        }
      } catch (error) {
        console.error('Erro ao carregar dados do usuário:', error);
        window.location.href = 'index.html';
      }

      // Carregar configurações salvas
      carregarConfiguracoes();
    });

    // Carregar configurações
    function carregarConfiguracoes() {
      // Carregar dados da empresa
      const dadosEmpresa = localStorage.getItem('dadosEmpresa');
      if (dadosEmpresa) {
        const dados = JSON.parse(dadosEmpresa);
        document.getElementById('nomeEmpresa').value = dados.nome || '';
        document.getElementById('cnpjEmpresa').value = dados.cnpj || '';
        document.getElementById('telefoneEmpresa').value = dados.telefone || '';
        document.getElementById('emailEmpresa').value = dados.email || '';
        document.getElementById('enderecoEmpresa').value = dados.endereco || '';
        document.getElementById('cidadeEmpresa').value = dados.cidade || '';
      }

      // Carregar preferências
      const preferencias = localStorage.getItem('preferencias');
      if (preferencias) {
        const prefs = JSON.parse(preferencias);
        document.getElementById('moedaPadrao').value = prefs.moeda || 'BRL';
        document.getElementById('fusoHorario').value = prefs.fuso || 'America/Sao_Paulo';
        document.getElementById('idioma').value = prefs.idioma || 'pt-BR';
        document.getElementById('tema').value = prefs.tema || 'light';
        document.getElementById('backupAutomatico').checked = prefs.backupAutomatico || false;
        document.getElementById('frequenciaBackup').value = prefs.frequenciaBackup || 'daily';
      }
    }

    // Alterar senha
    document.getElementById('alterarSenha').addEventListener('click', function() {
      const senhaAtual = document.getElementById('senhaAtual').value;
      const novaSenha = document.getElementById('novaSenha').value;
      const confirmarSenha = document.getElementById('confirmarSenha').value;

      if (!senhaAtual || !novaSenha || !confirmarSenha) {
        alert('Preencha todos os campos.');
        return;
      }

      if (novaSenha !== confirmarSenha) {
        alert('As senhas não coincidem.');
        return;
      }

      if (novaSenha.length < 6) {
        alert('A nova senha deve ter pelo menos 6 caracteres.');
        return;
      }

      // Aqui você faria a chamada para a API para alterar a senha
      alert('Senha alterada com sucesso!');
      
      // Limpar campos
      document.getElementById('senhaAtual').value = '';
      document.getElementById('novaSenha').value = '';
      document.getElementById('confirmarSenha').value = '';
    });

    // Salvar dados da empresa
    document.getElementById('salvarEmpresa').addEventListener('click', function() {
      const dados = {
        nome: document.getElementById('nomeEmpresa').value,
        cnpj: document.getElementById('cnpjEmpresa').value,
        telefone: document.getElementById('telefoneEmpresa').value,
        email: document.getElementById('emailEmpresa').value,
        endereco: document.getElementById('enderecoEmpresa').value,
        cidade: document.getElementById('cidadeEmpresa').value
      };

      localStorage.setItem('dadosEmpresa', JSON.stringify(dados));
      alert('Dados da empresa salvos com sucesso!');
    });

    // Salvar preferências
    document.getElementById('salvarPreferencias').addEventListener('click', function() {
      const preferencias = {
        moeda: document.getElementById('moedaPadrao').value,
        fuso: document.getElementById('fusoHorario').value,
        idioma: document.getElementById('idioma').value,
        tema: document.getElementById('tema').value,
        backupAutomatico: document.getElementById('backupAutomatico').checked,
        frequenciaBackup: document.getElementById('frequenciaBackup').value
      };

      localStorage.setItem('preferencias', JSON.stringify(preferencias));
      alert('Preferências salvas com sucesso!');
    });

    // Fazer backup
    document.getElementById('fazerBackup').addEventListener('click', function() {
      // Simular criação de backup
      const backup = {
        data: new Date().toISOString(),
        dados: {
          empresa: localStorage.getItem('dadosEmpresa'),
          preferencias: localStorage.getItem('preferencias')
        }
      };

      const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `backup_${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);

      alert('Backup criado com sucesso!');
    });

    // Restaurar backup
    document.getElementById('restaurarBackup').addEventListener('click', function() {
      document.getElementById('arquivoBackup').click();
    });

    document.getElementById('arquivoBackup').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const backup = JSON.parse(e.target.result);
          
          if (backup.dados.empresa) {
            localStorage.setItem('dadosEmpresa', backup.dados.empresa);
          }
          
          if (backup.dados.preferencias) {
            localStorage.setItem('preferencias', backup.dados.preferencias);
          }

          carregarConfiguracoes();
          alert('Backup restaurado com sucesso!');
        } catch (error) {
          alert('Erro ao restaurar backup. Verifique se o arquivo é válido.');
        }
      };
      reader.readAsText(file);
    });
  </script>

  <style>
    .config-area {
      background: var(--white);
      border-radius: var(--border-radius-lg);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: var(--shadow);
      border: 1px solid var(--gray-200);
    }

    .config-area h3 {
      color: var(--terciary);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .config-area .cards {
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    }

    @media (max-width: 768px) {
      .grid-cols-2 {
        grid-template-columns: 1fr;
      }
    }
  </style>
</body>
</html> 